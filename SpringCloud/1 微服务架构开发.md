# 1 单体架构应用的困境

![image-20220520163623497](https://oss-kelvinvan.oss-cn-chengdu.aliyuncs.com/img/image-20220520163623497.png)

## 1 变慢、变复杂

>  随着业务的扩张整体**变慢**， 越来越**复杂**， 无法在开发中展开敏捷模式

> - 开发
>
> - 部署
> - 运维

- 原因

> - 一个应用承载的职责太多
> - 其开发、部署和运维复杂度在后期呈几何形增长
>   - 编译+
>   - 协调+
>   - 测试+

## 2 逐渐不稳定

## 3 数据管理容易出现漏洞

## 4 开发上手难

> 新加入的开发者需要花更多的时间熟悉这些老技术; 而且这些老技术不容易替换
>
> - 而且这些技术可能已经有了项目的特定版本，个性化的改动
> - 使用同一个代码库，容易冲突，影响开发效率

## 5 部署无法水平扩展

> - 因为每一个应用实例对服务器来说都需要相同的硬件配置，这让服务器无法充分发挥其能力，造成浪费
> - 部署的服务速度会随着代码的累计逐渐变慢，性能降低



# 2 微服务架构

- ##### 1 区别于**模块化开发**

> - 服务有明确边界
>
>   - 易于开发、管控
>   - 易于单独部署、扩展
>
>   

- ##### 2 分而治之

<img src="https://oss-kelvinvan.oss-cn-chengdu.aliyuncs.com/img/image-20220520170229338.png" alt="image-20220520170229338" style="zoom:50%;float:left" />

## 1. 定义

- 如何将功能分解成一系列服务的一种架构模式
- 服务是一个可以独立运行、提供范围有限的功能（可以是业务功能，也有可能是非业务功能）的组件

### AFK可扩展模型：

![image-20220525092949432](https://oss-kelvinvan.oss-cn-chengdu.aliyuncs.com/img/image-20220525092949432.png)

- 三个维度：产品、流程、团队
- X **服务**水平复制 $\to$ 多实例集群-负载均衡
- Z 根据**数据**分区扩展 $\to$ 多实例，每个应用仅处理**部分数据**。 
  - 在其前面是业务路由，根据请求中的参数或某项属性（比如用户ID、订单ID等）将请求转发到不同的应用实例
- Y 根据**职责**拆分服务 $\to$ 在业务层面上进行拆分，形成多个微服务
  - X、Z仅仅提升了应用的 **容量**和**可用性**
  - 服务拆分：
    - 开发、运维复杂度--分而治之
    - 故障隔离
    - 提高请求响应
    - 团队工作聚焦



## 2. 优点

- 松耦合
- 抽象
- 独立
- 应对用户需求的多样性
- 更高可用性和弹性

## 3. 缺点

- #### 1可用性降低

  - 远程调用的代名词就是不稳定 

- #### 2处理分布式事务较棘手

  - 传统是两阶段提交，但对于微服务不是最好的选择，甚至难以实现

- #### 3全能对象(God Classes)阻止业务拆分

  - 比如商场中的**订单**，会涉及每一个业务模块，会阻止你进行业务拆分

- #### 4学习难度曲线加大

- #### 5组织架构变更

  - 单个微服务部署简化了，但是整个应用的部署复杂度却提升了
    - 服务编排
    - 服务治理
  - 人力需要协调不同的团队，以及人事组织上进行调整来适应这种变化



# 3 微服务架构设计

### 架构步骤

1. 定义应用中的关键需求
2. 识别出采用微服务架构时应用中所包含的所有服务
   1. 专注于业务，通过业务逻辑的视角可以快速有效地**识别核心服务**
   2. 围绕核心服务，定义出与之**关联的服务**
   3. 对这此服务分组，合并。最终定义出一系列微服务
3. 将关键需求作为架构需求的场景来描述**服务之间**如何进行协作
   1. 协作方式：同步、异步
   2. 交互方式：REST、RPC、消息

## 1.粒度



## 2.拆分原则

- SRP, Single Responsibility Principle

> There should never be more than one reason for a class to change.

- CCP, Common Closure Principle

> The class in package should be closed together aginst the same kinds of changes. 
>
> A change the effect s a package affects all the classes in that package.

## 3.自治原则

- 数据管理的私有化--各微服务团队看好自己的数据

## 4.交互原则

- 使用REST协议
- 使用URI表达
- 使用JSON数据格式
- 使用HTTP标准状态码

## 5. 架构迁移

Strangler，绞杀模式-- 藤蔓围绕大树，逐渐攀缘，最后绞死大树！

围绕传统应用，逐渐替代传统应用中的部分业务功能，最后传统应用退出



# 4 不应使用微服务架构的情形