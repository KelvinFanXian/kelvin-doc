# ref

- [分库分表技术演进&最佳实践](https://developer.aliyun.com/article/666034#slide-13)
- 

# 横向对比

| aspect | 阿里的<br />TDDL，DRDS和cobar | 开源社区的<br />sharing-sphere | 民间组织的<br />MyCAT | 360的<br />Atlas | 美团的<br />zebra |
| ---- | ----------------------------- | ----------------------------- | --------------------- | ---------------- | ----------------- |
| mode | client TDDL<br />proxy cobar | client<br />proxy | proxy |                  |                   |
|      |                               |                               |                       |                  |                   |



# mysql

- 单表可以存储**10亿**级数据
- **1KW**以下是最佳状态，因为这时它的**BTREE索引树高在3~5**之间



# not nosql

- 稳定性
- 事务特性



# not 分区

| 优点                       | 缺点                                                         |
| -------------------------- | ------------------------------------------------------------ |
| 对用户屏蔽了sharding的细节 | 很多的资源都受到**单机**的限制                               |
|                            | 虽然每个**分区**可以独立存储，<br />但是分区表的总入口还是一个MySQL实例<br />并发能力不足 |

- 使用场景
  - 数据不是海量（分区数有限，存储能力就有限）
  - 并发能力要求不高



# core

1. SQL解析
2. 重写
3. 路由
4. 执行
5. 结果归并



# sharding column

- 根据业务，提取流量大的API对应的SQL
  - 将这些SQL共同的条件作为sharding column



# elasticsearch, es

- 那些运营系统中的**模糊条件查询**，或者**上十个条件筛选**
  - 所有数据全量冗余到es中，将那些复杂的查询交给es处理





# evolution

| 一个sharding column | 多个sharding column                                   | sharding column分库分表 + es |
| ------------------- | ----------------------------------------------------- | ---------------------------- |
| 单维查询            | 多维查询，比如1订单🆔<br />对应【买家🆔/卖家🆔】组合查询 | 复杂查询                     |
|                     |                                                       |                              |



# es+HBase

> solr+HBase是主流

- 缓解es的压力。
  - 比如参与查询的字段占所有字段的1/5，
  - 则可以将4/5的非查询字段转移到HBase中，减小es的压力



# option comparison

| -          | 单个sc | 多个sc | sc+es    | sc+es+HBase |
| :--------- | :----- | :----- | :------- | :---------- |
| 适用场景   | 单一   | 一般   | 比较广泛 | 非常广泛    |
| 查询及时性 | 及时   | 及时   | 比较及时 | 比较及时    |
| 存储能力   | 一般   | 一般   | 较大     | 海量        |
| 代码成本   | 很小   | 较大   | 一般     | 一般        |
| 架构复杂度 | 简单   | 一般   | 较难     | 非常复杂    |



# more

- 数据同步的一致性问题
- 运行一段时间后，某些表的数据量慢慢达到单表瓶颈，这时候还需要做冷数据迁移
